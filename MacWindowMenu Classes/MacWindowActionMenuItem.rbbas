#tag ClassProtected Class MacWindowActionMenuItemInherits MenuItem	#tag Event		Function Action() As Boolean		  SendingCommand		  me.SendCommand GetCommandID		  CommandSent		  return true		End Function	#tag EndEvent	#tag Method, Flags = &h0		Sub Constructor()		  Super.MenuItem		  me.AutoEnable = false		  me.Text = me.LocalizedText(GetCommandID)		  		  Open		End Sub	#tag EndMethod	#tag Method, Flags = &h21		Private Function LocalizedText(commandID as String) As String		  if commandID = "" then		    return ""		  end if		  		  #if TargetCarbon		    soft declare Function CreateStandardWindowMenu Lib CarbonFramework (inOptions as Integer, ByRef outMenu as Integer) as Integer		    		    dim theMenu as Integer		    dim OSError as Integer = CreateStandardWindowMenu(0, theMenu)		    if OSError <> 0 or theMenu = 0 then		      return ""		    end if		    		    soft declare function GetIndMenuItemWithCommandID Lib CarbonFramework (inMenu as Integer, inCommandID as OSType, inItemIndex as Integer, outMenu as Integer, ByRef outIndex as UInt16) as Integer		    Const Null = 0		    dim theIndex as Uint16		    		    OSError = GetIndMenuItemWithCommandID(theMenu, commandID, 1, Null, theIndex)		    		    soft declare function CopyMenuItemTextAsCFString Lib CarbonFramework (inMenu as Integer, inItem as UInt16, ByRef outString as CFStringRef) as Integer		    dim menuItemText as CFStringRef		    OSError = CopyMenuItemTextAsCFString(theMenu, theIndex, menuItemText)		    		    soft declare sub CFRelease lib CarbonFramework (cf as Integer)		    CFRelease theMenu		    theMenu = 0		    		    return menuItemText		  #endif		  		exception fnf as FunctionNotFoundException		  		  		End Function	#tag EndMethod	#tag Method, Flags = &h21		Private Sub SendCommand(commandID as String)		  if commandID = "" then		    return		  end if		  		  soft declare function ProcessHICommand Lib CarbonFramework (inCommand as Ptr) as Integer		  		  dim command as MemoryBlock = new MemoryBlock(14)		  dim m as new MemoryBlock(4)		  m.LittleEndian = false		  m.StringValue(0, 4) = commandID		  command.UInt32Value(4) = m.UInt32Value(0)		  dim OSError as Integer = ProcessHICommand(command)		  		End Sub	#tag EndMethod	#tag Hook, Flags = &h0		Event CommandSent()	#tag EndHook	#tag Hook, Flags = &h0		Event GetCommandID() As String	#tag EndHook	#tag Hook, Flags = &h0		Event Open()	#tag EndHook	#tag Hook, Flags = &h0		Event SendingCommand()	#tag EndHook	#tag Constant, Name = CarbonFramework, Type = String, Dynamic = False, Default = \"Carbon.framework", Scope = Private	#tag EndConstant	#tag ViewBehavior		#tag ViewProperty			Name="AutoEnable"			Group="Behavior"			InitialValue="0"			Type="Boolean"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="Checked"			Group="Behavior"			InitialValue="0"			Type="Boolean"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="CommandKey"			Group="Behavior"			Type="String"			EditorType="MultiLineEditor"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="Enabled"			Group="Behavior"			InitialValue="0"			Type="Boolean"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="Icon"			Group="Behavior"			InitialValue="0"			Type="Picture"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="Index"			Visible=true			Group="ID"			InitialValue="-2147483648"			Type="Integer"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="KeyboardShortcut"			Group="Behavior"			Type="String"			EditorType="MultiLineEditor"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="Left"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Name"			Visible=true			Group="ID"			Type="String"			EditorType="MultiLineEditor"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="Super"			Visible=true			Group="ID"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Text"			Group="Behavior"			Type="String"			EditorType="MultiLineEditor"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="Top"			Visible=true			Group="Position"			InitialValue="0"			InheritedFrom="Object"		#tag EndViewProperty		#tag ViewProperty			Name="Visible"			Group="Behavior"			InitialValue="0"			Type="Boolean"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="_Bold"			Group="Behavior"			InitialValue="0"			Type="Boolean"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="_Italic"			Group="Behavior"			InitialValue="0"			Type="Boolean"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="_mIndex"			Group="Behavior"			InitialValue="0"			Type="Integer"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="_mName"			Group="Behavior"			Type="String"			EditorType="MultiLineEditor"			InheritedFrom="MenuItem"		#tag EndViewProperty		#tag ViewProperty			Name="_Underline"			Group="Behavior"			InitialValue="0"			Type="Boolean"			InheritedFrom="MenuItem"		#tag EndViewProperty	#tag EndViewBehaviorEnd Class#tag EndClass
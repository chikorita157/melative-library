#tag WindowBegin Window UpdateWin   BackColor       =   &hFFFFFF   Backdrop        =   ""   CloseButton     =   True   Composite       =   True   Frame           =   8   FullScreen      =   False   HasBackColor    =   False   Height          =   1.83e+2   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   ""   MenuBarVisible  =   True   MinHeight       =   64   MinimizeButton  =   True   MinWidth        =   64   Placement       =   0   Resizeable      =   True   Title           =   "Update"   Visible         =   True   Width           =   5.11e+2   Begin StaticText StaticText1      AutoDeactivate  =   True      Bold            =   True      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   28      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   14      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Multiline       =   True      Scope           =   0      TabIndex        =   0      TabPanelIndex   =   0      Text            =   "Updating: "      TextAlign       =   0      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   10      Underline       =   ""      Visible         =   True      Width           =   462   End   Begin UpDownArrows UpDownArrows1      AcceptFocus     =   False      AutoDeactivate  =   True      Enabled         =   False      Height          =   23      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   159      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      Top             =   54      Visible         =   True      Width           =   13   End   Begin TextField epiwatched      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      BackColor       =   16777215      Bold            =   ""      Border          =   True      CueText         =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   False      Format          =   ""      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   114      LimitText       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Mask            =   "###"      Password        =   ""      ReadOnly        =   ""      Scope           =   0      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextColor       =   0      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   54      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   39   End   Begin StaticText StaticText2      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   16      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Multiline       =   ""      Scope           =   0      TabIndex        =   3      TabPanelIndex   =   0      Text            =   "Segment:"      TextAlign       =   0      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   55      Underline       =   ""      Visible         =   True      Width           =   89   End   Begin CheckBox SegmentUpdate      AutoDeactivate  =   True      Bold            =   ""      Caption         =   "Update Segment"      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   14      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      State           =   0      TabIndex        =   4      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   31      Underline       =   ""      Value           =   False      Visible         =   True      Width           =   236   End   Begin CheckBox UpdateState      AutoDeactivate  =   True      Bold            =   ""      Caption         =   "Update State"      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   14      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      State           =   0      TabIndex        =   5      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   91      Underline       =   ""      Value           =   False      Visible         =   True      Width           =   236   End   Begin StaticText StaticText3      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   13      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Multiline       =   ""      Scope           =   0      TabIndex        =   6      TabPanelIndex   =   0      Text            =   "State:"      TextAlign       =   0      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   119      Underline       =   ""      Visible         =   True      Width           =   100   End   Begin PushButton PushButton1      AutoDeactivate  =   True      Bold            =   ""      Cancel          =   ""      Caption         =   "Update"      Default         =   True      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   415      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   8      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   150      Underline       =   ""      Visible         =   True      Width           =   80   End   Begin PushButton PushButton2      AutoDeactivate  =   True      Bold            =   ""      Cancel          =   True      Caption         =   "Cancel"      Default         =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   323      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   9      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   150      Underline       =   ""      Visible         =   True      Width           =   80   End   Begin ComboBox ComboBox1      AutoComplete    =   False      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   False      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialValue    =   "Unknown\rComplete\rPlanned\rCurrent\rStarted\rPaused\rResumed\rHold\rSubscribed\rWishlist\rMarathon\rBacklog\rDropped\r"      Italic          =   ""      Left            =   114      ListIndex       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   10      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   117      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   129   End   Begin ProgressWheel ProgressWheel1      AutoDeactivate  =   True      Enabled         =   True      Height          =   16      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   13      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   11      TabPanelIndex   =   0      TabStop         =   True      Top             =   150      Visible         =   False      Width           =   16   End   Begin CheckBox UpdateRating      AutoDeactivate  =   True      Bold            =   ""      Caption         =   "Update Rating"      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   270      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      State           =   0      TabIndex        =   13      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   32      Underline       =   ""      Value           =   False      Visible         =   True      Width           =   221   End   Begin TextField Rating1      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      BackColor       =   &hFFFFFF      Bold            =   ""      Border          =   True      CueText         =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   False      Format          =   ""      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   273      LimitText       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Mask            =   ""      Password        =   ""      ReadOnly        =   ""      Scope           =   0      TabIndex        =   14      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   56      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   58   End   Begin StaticText StaticText4      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   349      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Multiline       =   ""      Scope           =   0      TabIndex        =   15      TabPanelIndex   =   0      Text            =   "/"      TextAlign       =   0      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   56      Underline       =   ""      Visible         =   True      Width           =   22   End   Begin TextField Rating2      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      BackColor       =   &hFFFFFF      Bold            =   ""      Border          =   True      CueText         =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   False      Format          =   ""      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   369      LimitText       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Mask            =   ""      Password        =   ""      ReadOnly        =   ""      Scope           =   0      TabIndex        =   16      TabPanelIndex   =   0      TabStop         =   True      Text            =   100      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   56      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   55   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Sub Open()		  If Window1.mediatype = "Anime" then		    StaticText2.text = "Episodes:"		    segmentname = "episode"		  elseif Window1.mediatype = "manga" or Window1.mediatype = "lightnovel" then		    StaticText2.text = "Chapters:"		    segmentname = "chapter"		  elseif Window1.mediatype = "vn" then		    StaticText2.text = "Arc:"		    segmentname = ""		    UpDownArrows1.visible = false		    epiwatched.width = 130		    epiwatched.mask = ""		  end if		End Sub	#tag EndEvent	#tag Method, Flags = &h0		Sub RatingsUpdate()		  dim socket1 as new httpsocket		  dim form1 as new dictionary		  dim data as string		  If UpdateRating.value = true then		    If val(Rating1.text) <= val(rating2.text) then		      // Change Rating		      form1.value(Window1.mediatype) = titleprob		      form1.value("rating") = Rating1.text + "/" + rating2.text		      socket1.setFormData form1		      socket1.yield = true		      socket1.setrequestheader "Authorization","Basic " + app.loginenc		      data = socket1.post("http://melative.com/api/library/update_rating.xml",10)		      If socket1.httpstatuscode = 200  then		        UpdateState.enabled = false		        combobox1.enabled = false		        success = true		      else		        // Show Error		        errboxshowdialog("Melative Library was unable to update your rating. ", "Check your internet connection and try updating again.")		        progresswheel1.visible = false		      end if		    else		      errboxshowdialog("Melative Library was unable to update your rating. ", "Your rating is invalid since it's over 100%. Please enter a valid rating.")		      progresswheel1.visible = false		      success = false		    end if		  end if		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub StateUpdate()		  dim socket1 as new httpsocket		  dim form1 as new dictionary		  dim data as string		  If UpdateState.value = true then		    // Change State		    form1.value(Window1.mediatype) = titleprob		    form1.value("state") = ComboBox1.text		    socket1.setFormData form1		    socket1.yield = true		    socket1.setrequestheader "Authorization","Basic " + app.loginenc		    data = socket1.post("http://melative.com/api/library/update.json",10)		    If socket1.httpstatuscode = 200  then		      UpdateState.enabled = false		      combobox1.enabled = false		      success = true		    else		      // Show Error		      errboxshowdialog("Melative Library was unable to update your status. ", "Check your internet connection and try updating again.")		      success = false		      progresswheel1.visible = false		    end if		  end if		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub UpdateSegment()		  dim socket1 as new httpsocket		  dim form1 as new dictionary		  dim data as string		  If SegmentUpdate.value = true then		    // Scobble Title Only		    form1.value(Window1.mediatype) = titleprob		    If segmentname = "" then		      // It should never do this... but...		      form1.value("segment") = epiwatched.text		    else		      form1.value("segment") = segmentname + "|" + epiwatched.text		    end if		    socket1.setFormData form1		    socket1.yield = true		    socket1.setrequestheader "Authorization","Basic " + app.loginenc		    data = socket1.post("http://melative.com/api/library/segment/update.json",10)		    form1 = nil		    If socket1.httpstatuscode = 200 and UpdateState.value = false then		      epiwatched.enabled = false		      updownarrows1.enabled = false		      SegmentUpdate.enabled = false		      success = true		    elseif socket1.httpstatuscode = 200 and UpdateState.value = true then		    else		      // Show Error		      errboxshowdialog("Melative Library was unable to update your status. ", "Check your internet connection and try updating again.")		      progresswheel1.visible = false		      success = false		    end if		  end if		End Sub	#tag EndMethod	#tag Property, Flags = &h0		segmentname As string	#tag EndProperty	#tag Property, Flags = &h0		success As boolean = true	#tag EndProperty	#tag Property, Flags = &h0		titleprob As string	#tag EndProperty	#tag Property, Flags = &h0		updated As boolean	#tag EndProperty#tag EndWindowCode#tag Events UpDownArrows1	#tag Event		Sub Down()		  if val(epiwatched.text) > 0 then		    epiwatched.text = cstr(val(epiwatched.text)-1)		  else		    beep		  end if		End Sub	#tag EndEvent	#tag Event		Sub Up()		  		  epiwatched.text = cstr(val(epiwatched.text)+1)		End Sub	#tag EndEvent#tag EndEvents#tag Events epiwatched	#tag Event		Function KeyDown(Key As String) As Boolean		  If Window1.mediatype = "vn" then		  else		    if instr("0123456789."+chr(28)+ chr(29)+ chr(30)+ chr(31)+chr(3)+chr(9)+chr(10)+chr(8),key)>-1 then		      // handle specific keys from our list		    else		      // ignore the key		      return true		    end		  end if		End Function	#tag EndEvent#tag EndEvents#tag Events SegmentUpdate	#tag Event		Sub Action()		  If me.value = true then		    epiwatched.enabled = true		    UpDownArrows1.enabled = true		  else		    epiwatched.enabled = false		    UpDownArrows1.enabled = false		  end if		End Sub	#tag EndEvent#tag EndEvents#tag Events UpdateState	#tag Event		Sub Action()		  If me.value = true then		    combobox1.enabled = true		  elseif me.value = false then		    combobox1.enabled = false		  end if		End Sub	#tag EndEvent#tag EndEvents#tag Events PushButton1	#tag Event		Sub Action()		  me.enabled = false		  progresswheel1.visible = true		  If segmentupdate.enabled = true then		    updatesegment		  end if		  If UpdateState.enabled = true then		    stateupdate		  end if		  If UpdateRating.enabled = true then		    ratingsupdate		  end if		  		  If UpdateState.value = false and SegmentUpdate.value = false and updaterating.value = false then		    progresswheel1.visible = false		    errboxshowdialog("Melative Library was unable to update anything. ", "Select what you want to update and then try updating again.")		  else		    If success = true then		      updated = true		      window1.reloadcell(titleprob)		      hide		    end if		  end if		  me.enabled = true		End Sub	#tag EndEvent#tag EndEvents#tag Events PushButton2	#tag Event		Sub Action()		  hide		End Sub	#tag EndEvent#tag EndEvents#tag Events UpdateRating	#tag Event		Sub Action()		  if me.value = true then		    rating1.enabled = true		    rating2.enabled = true		  elseif me.value = false then		    rating1.enabled = false		    rating2.enabled = false		  end if		End Sub	#tag EndEvent#tag EndEvents#tag Events Rating1	#tag Event		Function KeyDown(Key As String) As Boolean		  if instr("0123456789."+chr(28)+ chr(29)+ chr(30)+ chr(31)+chr(3)+chr(9)+chr(10)+chr(8),key)>-1 then		    // handle specific keys from our list		  else		    // ignore the key		    return true		  end		End Function	#tag EndEvent#tag EndEvents#tag Events Rating2	#tag Event		Function KeyDown(Key As String) As Boolean		  if instr("0123456789."+chr(28)+ chr(29)+ chr(30)+ chr(31)+chr(3)+chr(9)+chr(10)+chr(8),key)>-1 then		    // handle specific keys from our list		  else		    // ignore the key		    return true		  end		End Function	#tag EndEvent#tag EndEvents
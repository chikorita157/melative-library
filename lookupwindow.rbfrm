#tag WindowBegin Window lookupwindow   BackColor       =   16777215   Backdrop        =   ""   CloseButton     =   True   Composite       =   True   Frame           =   0   FullScreen      =   False   HasBackColor    =   False   Height          =   3.87e+2   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   1408782882   MenuBarVisible  =   True   MinHeight       =   64   MinimizeButton  =   True   MinWidth        =   64   Placement       =   0   Resizeable      =   False   Title           =   "Title"   Visible         =   True   Width           =   6.0e+2   Begin StaticText SeriesTitle      AutoDeactivate  =   True      Bold            =   True      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   209      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Multiline       =   ""      Scope           =   0      TabIndex        =   3      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextAlign       =   0      TextColor       =   0      TextFont        =   "System"      TextSize        =   18      TextUnit        =   0      Top             =   6      Underline       =   ""      Visible         =   True      Width           =   393   End   Begin Canvas aniimage      AcceptFocus     =   ""      AcceptTabs      =   ""      AutoDeactivate  =   True      Backdrop        =   ""      DoubleBuffer    =   False      Enabled         =   True      EraseBackground =   True      Height          =   265      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   4      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   15      TabPanelIndex   =   0      TabStop         =   True      Top             =   6      UseFocusRing    =   True      Visible         =   True      Width           =   193   End   Begin httpsocket socket1      Address         =   ""      Enabled         =   True      Height          =   32      Index           =   -2147483648      Left            =   650      LockedInPosition=   False      Port            =   0      Scope           =   0      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      Top             =   140      Visible         =   True      Width           =   32      yield           =   0   End   Begin TextArea Description      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      BackColor       =   16777215      Bold            =   ""      Border          =   False      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Format          =   ""      Height          =   73      HelpTag         =   ""      HideSelection   =   True      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   203      LimitText       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Mask            =   ""      Multiline       =   True      ReadOnly        =   True      Scope           =   0      ScrollbarHorizontal=   ""      ScrollbarVertical=   True      Styled          =   True      TabIndex        =   0      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextColor       =   0      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   30      Underline       =   ""      UseFocusRing    =   False      Visible         =   True      Width           =   390   End   Begin GroupBox GroupBox3      AutoDeactivate  =   True      Bold            =   ""      Caption         =   "Resources"      Enabled         =   True      Height          =   133      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   407      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   31      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   240      Underline       =   ""      Visible         =   True      Width           =   186      Begin Listbox Resourcelistbox         AutoDeactivate  =   True         AutoHideScrollbars=   True         Bold            =   ""         Border          =   True         ColumnCount     =   1         ColumnsResizable=   ""         ColumnWidths    =   ""         DataField       =   ""         DataSource      =   ""         DefaultRowHeight=   -1         Enabled         =   True         EnableDrag      =   ""         EnableDragReorder=   ""         GridLinesHorizontal=   0         GridLinesVertical=   0         HasHeading      =   ""         HeadingIndex    =   -1         Height          =   105         HelpTag         =   ""         Hierarchical    =   ""         Index           =   -2147483648         InitialParent   =   "GroupBox3"         InitialValue    =   ""         Italic          =   ""         Left            =   417         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         RequiresSelection=   ""         Scope           =   0         ScrollbarHorizontal=   ""         ScrollBarVertical=   True         SelectionType   =   0         TabIndex        =   0         TabPanelIndex   =   0         TabStop         =   True         TextFont        =   "System"         TextSize        =   12         TextUnit        =   0         Top             =   261         Underline       =   ""         UseFocusRing    =   False         Visible         =   True         Width           =   166         _ScrollWidth    =   -1      End   End   Begin GroupBox StatisticsBox      AutoDeactivate  =   True      Bold            =   ""      Caption         =   "Statistics"      Enabled         =   True      Height          =   119      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   407      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   32      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   115      Underline       =   ""      Visible         =   True      Width           =   184      Begin StaticText Ranking         AutoDeactivate  =   True         Bold            =   False         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "StatisticsBox"         Italic          =   ""         Left            =   416         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         Multiline       =   ""         Scope           =   0         TabIndex        =   0         TabPanelIndex   =   0         TabStop         =   True         Text            =   "Ranked: "         TextAlign       =   0         TextColor       =   0         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   161         Underline       =   ""         Visible         =   True         Width           =   100      End      Begin StaticText Approval         AutoDeactivate  =   True         Bold            =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "StatisticsBox"         Italic          =   ""         Left            =   416         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         Multiline       =   ""         Scope           =   0         TabIndex        =   1         TabPanelIndex   =   0         TabStop         =   True         Text            =   "Approval:"         TextAlign       =   0         TextColor       =   0         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   137         Underline       =   ""         Visible         =   True         Width           =   136      End      Begin StaticText Popularity         AutoDeactivate  =   True         Bold            =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "StatisticsBox"         Italic          =   ""         Left            =   416         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         Multiline       =   ""         Scope           =   0         TabIndex        =   3         TabPanelIndex   =   0         TabStop         =   True         Text            =   "Popularity:"         TextAlign       =   0         TextColor       =   0         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   205         Underline       =   ""         Visible         =   True         Width           =   127      End      Begin StaticText Members         AutoDeactivate  =   True         Bold            =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Height          =   20         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "StatisticsBox"         Italic          =   ""         Left            =   416         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         Multiline       =   ""         Scope           =   0         TabIndex        =   4         TabPanelIndex   =   0         TabStop         =   True         Text            =   "Users:"         TextAlign       =   0         TextColor       =   0         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   183         Underline       =   ""         Visible         =   True         Width           =   136      End   End   Begin BevelButton BevelButton1      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   "&c000000"      Bevel           =   3      Bold            =   False      ButtonType      =   0      Caption         =   "Use"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   26      HelpTag         =   "Make a Microblog post on this title"      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   19      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      MenuValue       =   0      Scope           =   0      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   "&c000000"      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   292      Underline       =   False      Value           =   False      Visible         =   True      Width           =   161   End   Begin BevelButton BevelButton2      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   "&c000000"      Bevel           =   3      Bold            =   False      ButtonType      =   0      Caption         =   "Recommend this Title"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   25      HelpTag         =   "Recommend the Current Title"      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   20      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      MenuValue       =   0      Scope           =   0      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   "&c000000"      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   330      Underline       =   False      Value           =   False      Visible         =   True      Width           =   161   End   Begin GroupBox GroupBox1      AutoDeactivate  =   True      Bold            =   ""      Caption         =   "Basic"      Enabled         =   True      Height          =   258      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   203      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   33      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   115      Underline       =   ""      Visible         =   True      Width           =   200      Begin StaticText baseinformation         AutoDeactivate  =   True         Bold            =   ""         DataField       =   ""         DataSource      =   ""         Enabled         =   True         Height          =   220         HelpTag         =   ""         Index           =   -2147483648         InitialParent   =   "GroupBox1"         Italic          =   ""         Left            =   219         LockBottom      =   ""         LockedInPosition=   False         LockLeft        =   True         LockRight       =   ""         LockTop         =   True         Multiline       =   True         Scope           =   0         TabIndex        =   0         TabPanelIndex   =   0         TabStop         =   True         Text            =   ""         TextAlign       =   0         TextColor       =   0         TextFont        =   "System"         TextSize        =   0         TextUnit        =   0         Top             =   140         Underline       =   ""         Visible         =   True         Width           =   168      End   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Sub Open()		  me.HasToolbarButton = false		  //set up yourlist listbox		  Resourcelistbox.columncount=2		  Resourcelistbox.columnwidths="0,100%"		  Resourcelistbox.HasHeading=True		  Resourcelistbox.Heading(0)="ID"		  Resourcelistbox.Heading(1)="Resource"		  Resourcelistbox.Column(0).UserResizable=false		End Sub	#tag EndEvent	#tag MenuHandler		Function FileClose() As Boolean Handles FileClose.Action			me.close			Return True					End Function	#tag EndMenuHandler	#tag MenuHandler		Function FilePrint() As Boolean Handles FilePrint.Action			// Print Window			try			dim p as picture = newPicture(self.width,self.height,32)			dim g as graphics = p.graphics			dim printG as graphics = openprinterdialog(nil,self)			if g<> nil then			self.drawinto g,1,1			printG.drawPicture p,1,1			end if			catch			end try		End Function	#tag EndMenuHandler	#tag Method, Flags = &h0		Sub loadcontext(rootxml as xmlnode)		  dim p as new xmlnodelist		  dim d as new dictionary		  dim  i  as integer		  p = getanything(rootxml,"//response/context")		  d = parseInfo(p.Item(0))		  seriesid = d.value("id")		  		  If d.haskey("description") = true then		    description.text = ReplaceAll(d.value("description"),"<br />", EndOfLine)		  else		    description.text = "No description for this title"		  end if		  //Statistics		  If d.haskey("approval") = true then		    approval.text = "Approval: " + d.value("approval")		  end if		  If d.haskey("rank") = true then		    Ranking.text = "Ranked: " + d.value("rank")		  end if		  If d.haskey("users") = true then		    members.text = "Users: " + d.value("users")		  end if		  If d.haskey("popularity") = true then		    popularity.text = "Popularity: " + d.value("popularity")		  end if		  		  //Load Image		  If d.haskey("image_url") = true then		    dim t as new dictionary		    t = d.value("image_url")		    		    loadimage(replaceall(t.value(0) ,".jpg", ".193.jpg"))		  end if		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub loadimage(url as string)		  dim s as picture		  // Obtain the image		  dim c as integer		  //Attempt to get the image on 2 tries		  For c=1 to 2		    s = getpictFromURL(url)		    If s isa picture then		      exit		    end if		  next		  If s = nil then		  else		    dim imgw, imgh, sourcew,sourceh, ratio as integer		    sourcew = s.width		    sourceh = s.height		    If sourceh >= sourcew then		      ratio = (sourceh/sourcew)		      imgh =(254/ratio)		      imgw =193		    elseif sourceh <= sourcew then		      ratio = (sourcew/sourceh)		      imgh =254		      imgw =(193/ratio)		    end if		    // Resizing Image to fit Canvas (aniimage)		    Dim p as New Picture(imgw,imgh,32) //creating new picture (width, height, depth)		    		    p.Graphics.DrawPicture (s,0,0,imgw, imgh,0,0,s.width, s.height)		    		    		    aniimage.Backdrop = p // loading the picture from memory to Aniipicture		    Aniimage.Refresh		    p = nil		    s= nil		  end if		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub loadmelativexml()		  dim socket1 as new httpsocket		  dim listdata as string		  dim r as xmlnode		  socket1.yield = true		  listdata= socket1.get("http://melative.com/api/entity/metab.xml?" + mediatype + "=" + EncodeURLComponent(seriestitle.text) ,10)		  If socket1.httpstatuscode = 200 then		    //reset everything		    baseinformation.text =  ""		    description.text = ""		    resourcelistbox.deleteallrows		    //start loading		    dim XML as new XMLDocument		    xml.LoadXML(listdata)		    r = getXMLroot(xml)		    loadresources(r)		    loadcontext(r)		    loadproperties(r)		  end if		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub loadproperties(rootxml as xmlnode)		  dim p as new xmlnodelist		  dim p2 as new xmlnodelist		  dim d as new dictionary		  dim d2 as new dictionary		  dim i  as integer		  p = getanything(rootxml,"//response/context/property-list")		  try		    d = parseAnime(p.Item(0))		    for i = 0 to d.count -1		      p2 = getanything(rootxml,"//response/context/property-list/" + d.key(i))		      d2 = parseAnime(p2.Item(0))		      If i = 0 then		        baseinformation.text = d.key(i) + ":"+ d2.value(d2.key(0))		      else		        baseinformation.text = d.key(i) + ":"+ d2.value(d2.key(0)) + endofline + baseinformation.text		      end if		    next		  catch		    baseinformation.text ="No base information available."		  end try		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub loadresources(rootxml as xmlnode)		  dim p as new xmlnodelist		  dim d as new dictionary		  dim c , i  as integer		  try		    p = getanything(rootxml,"//response/context/resource-list/resource")		    c = p.Length - 1		    for i = 0 to c		      d = parseAnime(p.Item(i))		      Resourcelistbox.AddRow(d.Value("url"))		      If d.haskey("title")  then		        Resourcelistbox.Cell(Resourcelistbox.LastIndex, 1) = d.value("title")		        Resourcelistbox.CellHelpTag(Resourcelistbox.LastIndex, 1) = d.value("url")		      else		        Resourcelistbox.Cell(Resourcelistbox.LastIndex, 1) = d.Value("url")		      end if		    next		  catch		  end try		  		End Sub	#tag EndMethod	#tag Property, Flags = &h0		mediatype As string	#tag EndProperty	#tag Property, Flags = &h0		seriesid As string	#tag EndProperty#tag EndWindowCode#tag Events Resourcelistbox	#tag Event		Sub DoubleClick()		  showurl me.cell(me.listindex,0)		End Sub	#tag EndEvent	#tag Event		Function CellBackgroundPaint(g As Graphics, row As Integer, column As Integer) As Boolean		  #If TargetMacOS		    if row mod 2 = 0 then		      g.forecolor = GetThemeColor(kThemeBrushListViewOddRowBackground)		    else		      g.forecolor = GetThemeColor(kThemeBrushListViewEvenRowBackground)		    end		    g.fillrect(0,0,g.width,g.height)		  #endif		End Function	#tag EndEvent#tag EndEvents#tag Events BevelButton1	#tag Event		Sub Action()		  ShowUseDialog(seriestitle.text,mediatype)		End Sub	#tag EndEvent#tag EndEvents#tag Events BevelButton2	#tag Event		Sub Action()		  RecommendTitle(seriestitle.text,mediatype)		End Sub	#tag EndEvent#tag EndEvents
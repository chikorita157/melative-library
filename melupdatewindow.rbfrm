#tag WindowBegin Window melupdatewindow   BackColor       =   16777215   Backdrop        =   ""   CloseButton     =   True   Composite       =   True   Frame           =   0   FullScreen      =   False   HasBackColor    =   False   Height          =   2.23e+2   ImplicitInstance=   True   LiveResize      =   False   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   1408782882   MenuBarVisible  =   True   MinHeight       =   64   MinimizeButton  =   True   MinWidth        =   64   Placement       =   0   Resizeable      =   False   Title           =   "Posting Melative Update"   Visible         =   True   Width           =   5.34e+2   Begin StaticText StaticText2      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Multiline       =   ""      Scope           =   0      TabIndex        =   0      TabPanelIndex   =   0      Text            =   "Action:"      TextAlign       =   2      TextColor       =   0      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   42      Underline       =   ""      Visible         =   True      Width           =   100   End   Begin TextArea commentsfield      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      BackColor       =   16777215      Bold            =   ""      Border          =   True      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Format          =   ""      Height          =   52      HelpTag         =   ""      HideSelection   =   True      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   112      LimitText       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Mask            =   ""      Multiline       =   True      ReadOnly        =   ""      Scope           =   0      ScrollbarHorizontal=   ""      ScrollbarVertical=   True      Styled          =   True      TabIndex        =   10      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextColor       =   0      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   91      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   389   End   Begin StaticText StaticText3      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Multiline       =   ""      Scope           =   0      TabIndex        =   0      TabPanelIndex   =   0      Text            =   "Message:"      TextAlign       =   2      TextColor       =   0      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   91      Underline       =   ""      Visible         =   True      Width           =   100   End   Begin CheckBox CheckBox1      AutoDeactivate  =   True      Bold            =   ""      Caption         =   "Include Segment Information"      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   180      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      State           =   0      TabIndex        =   12      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   152      Underline       =   ""      Value           =   False      Visible         =   True      Width           =   194   End   Begin PushButton PushButton1      AutoDeactivate  =   True      Bold            =   ""      Cancel          =   ""      Caption         =   "Post"      Default         =   True      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   444      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   13      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   193      Underline       =   ""      Visible         =   True      Width           =   80   End   Begin httpsocket socket1      Address         =   ""      Height          =   32      Index           =   -2147483648      Left            =   256      LockedInPosition=   False      Port            =   0      Scope           =   0      TabPanelIndex   =   0      Top             =   163      Width           =   32      yield           =   0   End   Begin StaticText Segmentlbl      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Multiline       =   ""      Scope           =   0      TabIndex        =   0      TabPanelIndex   =   0      Text            =   "Episode:"      TextAlign       =   2      TextColor       =   0      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   152      Underline       =   ""      Visible         =   True      Width           =   100   End   Begin TextField epi      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      BackColor       =   16777215      Bold            =   ""      Border          =   True      CueText         =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Format          =   ""      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   112      LimitText       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Mask            =   ""      Password        =   ""      ReadOnly        =   ""      Scope           =   0      TabIndex        =   11      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextColor       =   0      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   152      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   56   End   Begin ComboBox TextField1      AutoComplete    =   False      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialValue    =   "Watching\rBacklog\rCompleted\rDrop\rPlayed\rPlaying\rRead\rReading\rWatched\rWishlisted"      Italic          =   ""      Left            =   112      ListIndex       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   3      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   41      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   176   End   Begin StaticText LastUpdate      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   30      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   11      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Multiline       =   True      Scope           =   0      TabIndex        =   7      TabPanelIndex   =   0      Text            =   ""      TextAlign       =   0      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   184      Underline       =   ""      Visible         =   True      Width           =   411   End   Begin TextField titletext      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      BackColor       =   &hFFFFFF      Bold            =   ""      Border          =   True      CueText         =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Format          =   ""      Height          =   22      HelpTag         =   "Type your title of your series here"      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   17      LimitText       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Mask            =   ""      Password        =   ""      ReadOnly        =   ""      Scope           =   0      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   13      TextUnit        =   0      Top             =   9      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   317   End   Begin PopupMenu PopupMenu1      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   "anime\rmanga\rlightnovel\rvn\radrama"      Italic          =   ""      Left            =   344      ListIndex       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   10      Underline       =   ""      Visible         =   True      Width           =   107   End   Begin BevelButton BoldBut      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   "&c000000"      Bevel           =   0      Bold            =   True      ButtonType      =   0      Caption         =   "b"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   22      HelpTag         =   "Bold"      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   112      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      MenuValue       =   0      Scope           =   0      TabIndex        =   5      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   "&c000000"      TextFont        =   "System"      TextSize        =   ""      TextUnit        =   0      Top             =   66      Underline       =   False      Value           =   False      Visible         =   True      Width           =   29   End   Begin BevelButton ItalicBut      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   &h000000      Bevel           =   0      Bold            =   False      ButtonType      =   0      Caption         =   "i"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   22      HelpTag         =   "Italic"      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   True      Left            =   144      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      MenuValue       =   0      Scope           =   0      TabIndex        =   6      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   ""      TextUnit        =   0      Top             =   66      Underline       =   False      Value           =   False      Visible         =   True      Width           =   29   End   Begin BevelButton delbut      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   "&c000000"      Bevel           =   0      Bold            =   False      ButtonType      =   0      Caption         =   "del"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   22      HelpTag         =   "Strike"      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   177      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      MenuValue       =   0      Scope           =   0      TabIndex        =   7      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   "&c000000"      TextFont        =   "System"      TextSize        =   ""      TextUnit        =   0      Top             =   66      Underline       =   False      Value           =   False      Visible         =   True      Width           =   37   End   Begin BevelButton bigbut      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   "&c000000"      Bevel           =   0      Bold            =   False      ButtonType      =   0      Caption         =   "big"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   22      HelpTag         =   ""      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   217      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      MenuValue       =   0      Scope           =   0      TabIndex        =   8      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   "&c000000"      TextFont        =   "System"      TextSize        =   ""      TextUnit        =   0      Top             =   66      Underline       =   False      Value           =   False      Visible         =   True      Width           =   38   End   Begin BevelButton smallbut      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   "&c000000"      Bevel           =   0      Bold            =   False      ButtonType      =   0      Caption         =   "small"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   22      HelpTag         =   ""      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   259      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      MenuValue       =   0      Scope           =   0      TabIndex        =   9      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   "&c000000"      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   66      Underline       =   False      Value           =   False      Visible         =   True      Width           =   43   End   Begin CheckBox sendtotwitter      AutoDeactivate  =   True      Bold            =   ""      Caption         =   "Send to Twitter"      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   "Appends @tw to the message to tell Melative to post the update on your connected Twitter account. Twitter Bridge must be turned on to use this feature."      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   366      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      State           =   0      TabIndex        =   14      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   152      Underline       =   ""      Value           =   False      Visible         =   True      Width           =   124   End   Begin BevelButton BevelButton2      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   "&c000000"      Bevel           =   0      Bold            =   False      ButtonType      =   0      Caption         =   "Upload Image"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   21      HelpTag         =   ""      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   306      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      MenuValue       =   0      Scope           =   0      TabIndex        =   15      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   "&c000000"      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   67      Underline       =   False      Value           =   False      Visible         =   True      Width           =   82   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Sub Activate()		  KeyboardUIMode.SetControls(self,KeyboardUIMode.GetMode)		End Sub	#tag EndEvent	#tag Event		Function CancelClose(appQuitting as Boolean) As Boolean		  if modified = true then		    Dim d as New MessageDialog //declare the MessageDialog object		    Dim b as MessageDialogButton //for handling the result		    d.icon=MessageDialog.GraphicCaution //display warning icon		    d.ActionButton.Caption="Discard"		    d.CancelButton.Visible=True    //show the Cancel button		    d.Message="Are you sure you want to discard this unsaved update?"		    d.Explanation="Your update will be lost."		    b=d.ShowModalWithin(self.TrueWindow)//display the dialog		    Select Case b //determine which button was pressed.		    Case d.ActionButton		      //user pressed Delete		      return false		    Case d.CancelButton		      //user pressed Cancel		      return true		    End select		  else		    return false		  end if		End Function	#tag EndEvent	#tag MenuHandler		Function FileClose() As Boolean Handles FileClose.Action			self.close			Return True					End Function	#tag EndMenuHandler	#tag Method, Flags = &h0		Sub melpostupdate()		  pushbutton1.enabled = false		  dim data as string		  		  // create and populate the form object		  dim form2 as New Dictionary		  // Set content		  		  // Use Normal Updating		  // Figure out the num of episodes. If zero, episode part will not be shown in the update		  dim commentsmsg as string		  commentsmsg =  ReplaceLineEndings(commentsfield.text, EndOfLine.UNIX)		  If checkbox1.value= true then		    If epi.text = "" then		      form2.value("message") = "/" + lowercase(TextField1.text )+ " /"+ popupmenu1.text + "/" + titletext.text + "/: " + commentsmsg		    else		      form2.value("message") = "/" + lowercase(TextField1.text) + " /"+ popupmenu1.text + "/"  + titletext.text+ "/" + lowercase(segmenttitle) +"/" + epi.text + ": " + commentsmsg		    end if		  else		    form2.value("message") = "/" + lowercase(TextField1.text) + " /"+ popupmenu1.text + "/"  + titletext.text + "/: " + commentsmsg		  end if		  // Set Client ( e.g. <username> in anime <time> ago from Melative Library)		  form2.value("source") = "Melative Library"		  // Send to Twitter?		  If sendtotwitter.value = true then		    form2.value("message") = form2.value("message")  + " @tw"		  end if		  // setup the socket to POST the form		  socket1.setFormData form2		  socket1.setrequestheader "Authorization","Basic " + app.loginenc		  data = socket1.post("http://melative.com/api/micro/update.json",10)		  		  // release data from memory		  form2 = nil		  If socket1.httpstatuscode = 200 then		    If window1.streamwindow = true then		      TimeLine.loadtimeline		    end if		    LastUpdate.text = "Last Update: " + commentsfield.text		    commentsfield.text = ""		    pushbutton1.enabled = true		    self.IsModified = false		    modified = false		  else		    // Show Error		    self.errboxshow("Melative Library was unable to post your update on Melative",   "Check to see if your internet connection is working or revertify your Melative account information and try posting your update again.")		    pushbutton1.enabled = true		  end if		  		End Sub	#tag EndMethod	#tag Property, Flags = &h0		modified As boolean	#tag EndProperty	#tag Property, Flags = &h0		segmenttitle As string = "Episode"	#tag EndProperty#tag EndWindowCode#tag Events commentsfield	#tag Event		Sub TextChange()		  self.IsModified = true		  modified = true		End Sub	#tag EndEvent#tag EndEvents#tag Events PushButton1	#tag Event		Sub Action()		  If titletext.text = "" then		    self.errboxshow("Melative Library was unable to post the update.", "You cannot leave the title field blank. You must specify a title.")		  else		    If textfield1.text = "" then		      self.errboxshow("Melative Library was unable to post the update.", "You cannot leave the action field blank. You must use a valid action or 'on' to post this update")		    else		      if commentsfield.text = "" then		        self.errboxshow("Melative Library was unable to post the update.", "You cannot leave the message field blank. You must have a message written.")		      else		        melpostupdate		      end if		    end if		  end if		End Sub	#tag EndEvent#tag EndEvents#tag Events epi	#tag Event		Function KeyDown(Key As String) As Boolean		  if instr("0123456789."+chr(28)+ chr(29)+ chr(30)+ chr(31)+chr(3)+chr(9)+chr(10)+chr(8),key)>-1 then		    // handle specific keys from our list		  else		    // ignore the key		    return true		  end		End Function	#tag EndEvent#tag EndEvents#tag Events titletext	#tag Event		Sub TextChange()		  self.Title = "Posting Melative Update - " + titletext.text		End Sub	#tag EndEvent#tag EndEvents#tag Events PopupMenu1	#tag Event		Sub Change()		  If me.text = "anime" or me.text = "adrama" then		    segmenttitle = "Episode"		    Segmentlbl.text = "Episode:"		  elseif me.text = "manga" or  me.text = "lightnovel" then		    segmenttitle = "Chapter"		    Segmentlbl.text = "Chapter:"		  elseif me.text = "vn" then		    segmenttitle = ""		    Segmentlbl.text = "Arc:"		  end if		End Sub	#tag EndEvent#tag EndEvents#tag Events BoldBut	#tag Event		Sub Action()		  commentsfield.text = commentsfield.text + "<b></b>"		  commentsfield.selstart = commentsfield.text.Len		End Sub	#tag EndEvent#tag EndEvents#tag Events ItalicBut	#tag Event		Sub Action()		  commentsfield.text = commentsfield.text + "<i></i>"		  commentsfield.selstart = commentsfield.text.Len		End Sub	#tag EndEvent#tag EndEvents#tag Events delbut	#tag Event		Sub Action()		  commentsfield.text = commentsfield.text + "<del></del>"		  commentsfield.selstart = commentsfield.text.Len		End Sub	#tag EndEvent#tag EndEvents#tag Events bigbut	#tag Event		Sub Action()		  commentsfield.text = commentsfield.text + "<big></big>"		  commentsfield.selstart = commentsfield.text.Len		End Sub	#tag EndEvent#tag EndEvents#tag Events smallbut	#tag Event		Sub Action()		  commentsfield.text = commentsfield.text + "<small></small>"		  commentsfield.selstart = commentsfield.text.Len		End Sub	#tag EndEvent#tag EndEvents#tag Events BevelButton2	#tag Event		Sub Action()		  // Define File Types		  Dim jpegType as New FileType		  jpegType.Name = "image/jpeg"		  jpegType.MacType = "JPEG"		  jpegType.Extensions = "jpg;jpeg"		  		  Dim pngType As New FileType		  pngType.Name = "image/png"		  pngType.MacType = "PNG "		  pngType.Extensions = "png"		  		  Dim gifType As New FileType		  gifType.Name = "image/gif"		  gifType.MacType = "GIF "		  gifType.Extensions = "gif"		  		  Dim dlg as New OpenDialog		  dim f as folderItem		  dlg.InitialDirectory=SpecialFolder.Documents		  dlg.Title="Image Upload"		  dlg.filter = jpegtype + gifType // Suporting only GIF/JPG images ATM		  f=dlg.ShowModalWithin(self.truewindow)		  		  If f <> Nil then		    Dim socket1 as New HTTPSocket		    		    Dim data, rawdata, nl, encodedFileName As String		    Const boundary = "--------0xKhTmLbOuNdArY"		    		    ' for convenience:		    nl = chr(13) + chr(10) ' CRLF, used as MIME end-of-line character		    		    // Step 1: get file data in uploadable form		    Dim bs As BinaryStream		    bs = f.OpenAsBinaryFile		    rawdata = bs.Read(f.length) ' gulp!		    		    // Step 2: create the form data		    // Have to create a multipart form manually		    encodedFileName = EncodeURLComponent(f.Name) ' convenience		    		    // start with boundary line		    data="--" + boundary + nl		    		    // Next, add a section for the form field we're uploading		    // (in this case, the field is named "userfile" and includes the name of the file)		    data = data + "Key: 5BSZ4EAH87ff1baa0805a78ac1ac39b55e213213" + nl + nl + "Content-Disposition: multipart/form-data; name=""fileupload""" + nl + nl + encodedFileName + nl		    		    // boundary to separate the above from the next part		    data = data + "--" + boundary + nl		    		    // Next comes the actual file itself, with headers indicating what type it is		    // and what content type we're using (raw binary in this case)		    data = data + "Content-Disposition: multipart/form-data; name=""fileupload""; filename=""" + encodedFileName + """" + nl + "Content-Type: " + dlg.Result.Type  + nl + "Content-Length: " + str(lenb(rawdata)) + nl + "Content-Transfer-Encoding: binary" + nl + nl + rawdata + nl		    		    // Now our closing boundary marker, and our data is ready to send		    data = data + "--" + boundary + nl + nl		    //whew...		    		    // Step 3: create socket and set headers		    ' h = new PostSocket ' Moved to Window1.DoUpload		    // I created a PostSocket subclass so I could use the pageReceived event to		    // view the results of my upload.		    socket1.SetPostContent data, "multipart/form-data, boundary=" + boundary		    data = socket1.post("http://www.imageshack.us/upload_api.php",10)		    If socket1.httpstatuscode = 200 then		      dim XML as new XMLDocument		      dim d as new dictionary // store item information		      dim p as new xmlnodelist // store item information		      dim c , i, pcount as integer		      dim r as xmlnode		      xml.LoadXML(data)		      r = getXMLroot(xml)		      p = getanything(r, "//links") // load item information		      c = p.Length - 1		      for i = 0 to c		        d = parseAnime(p.Item(i))		      next		      if d.haskey("image_link") = true then		        commentsfield.text = "#image " + d.value("Image_link") + endofline + commentsfield.text		      end if		    else		      // Show Error		      self.errboxshow("Melative Library was unable to upload the image you selected.",   "Check to see if your internet connection is working and try uploading your image again.")		      pushbutton1.enabled = true		    end if		    		  Else		    //user canceled		  End if		End Sub	#tag EndEvent#tag EndEvents
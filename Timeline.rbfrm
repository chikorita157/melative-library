#tag WindowBegin Window Timeline   BackColor       =   &hFFFFFF   Backdrop        =   ""   CloseButton     =   True   Composite       =   True   Frame           =   0   FullScreen      =   False   HasBackColor    =   False   Height          =   4.14e+2   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   True   MaxWidth        =   500   MenuBar         =   866092770   MenuBarVisible  =   True   MinHeight       =   414   MinimizeButton  =   True   MinWidth        =   297   Placement       =   0   Resizeable      =   True   Title           =   "Stream"   Visible         =   True   Width           =   2.97e+2   Begin TextArea commentsfield      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      BackColor       =   &hFFFFFF      Bold            =   ""      Border          =   True      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Format          =   ""      Height          =   62      HelpTag         =   ""      HideSelection   =   True      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   0      LimitText       =   0      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   False      Mask            =   ""      Multiline       =   True      ReadOnly        =   ""      Scope           =   0      ScrollbarHorizontal=   ""      ScrollbarVertical=   True      Styled          =   True      TabIndex        =   6      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   348      Underline       =   ""      UseFocusRing    =   False      Visible         =   True      Width           =   205   End   Begin PushButton PushButton1      AutoDeactivate  =   True      Bold            =   ""      Cancel          =   ""      Caption         =   "Update"      Default         =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   210      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   False      Scope           =   0      TabIndex        =   7      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   386      Underline       =   ""      Visible         =   True      Width           =   80   End   Begin StaticText MessageLength      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   210      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   False      Multiline       =   ""      Scope           =   0      TabIndex        =   4      TabPanelIndex   =   0      Text            =   0      TextAlign       =   0      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   348      Underline       =   ""      Visible         =   True      Width           =   50   End   Begin Timer Timer1      Height          =   32      Index           =   -2147483648      Left            =   415      LockedInPosition=   False      Mode            =   2      Period          =   300000      Scope           =   0      TabPanelIndex   =   0      Top             =   180      Width           =   32   End   Begin HTMLViewer HTMLViewer1      AutoDeactivate  =   True      Enabled         =   True      Height          =   322      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   0      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      Scope           =   0      TabIndex        =   0      TabPanelIndex   =   0      Top             =   0      Visible         =   True      Width           =   298   End   Begin BevelButton BevelButton1      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   "&c000000"      Bevel           =   0      Bold            =   False      ButtonType      =   0      Caption         =   ""      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   20      HelpTag         =   "Refresh Stream"      Icon            =   442803607      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   272      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   False      MenuValue       =   0      Scope           =   0      TabIndex        =   8      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   "&c000000"      TextFont        =   "System"      TextSize        =   ""      TextUnit        =   0      Top             =   348      Underline       =   False      Value           =   False      Visible         =   True      Width           =   20   End   Begin BevelButton smallbut      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   &h000000      Bevel           =   0      Bold            =   False      ButtonType      =   0      Caption         =   "small"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   22      HelpTag         =   ""      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   149      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      MenuValue       =   0      Scope           =   0      TabIndex        =   5      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   323      Underline       =   False      Value           =   False      Visible         =   True      Width           =   43   End   Begin BevelButton ItalicBut      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   &h000000      Bevel           =   0      Bold            =   False      ButtonType      =   0      Caption         =   "i"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   22      HelpTag         =   "Italic"      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   True      Left            =   34      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      MenuValue       =   0      Scope           =   0      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   ""      TextUnit        =   0      Top             =   323      Underline       =   False      Value           =   False      Visible         =   True      Width           =   29   End   Begin BevelButton BoldBut      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   &h000000      Bevel           =   0      Bold            =   True      ButtonType      =   0      Caption         =   "b"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   22      HelpTag         =   "Bold"      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   2      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      MenuValue       =   0      Scope           =   0      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   ""      TextUnit        =   0      Top             =   323      Underline       =   False      Value           =   False      Visible         =   True      Width           =   29   End   Begin BevelButton delbut      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   &h000000      Bevel           =   0      Bold            =   False      ButtonType      =   0      Caption         =   "del"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   22      HelpTag         =   "Strike"      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   67      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      MenuValue       =   0      Scope           =   0      TabIndex        =   3      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   ""      TextUnit        =   0      Top             =   323      Underline       =   False      Value           =   False      Visible         =   True      Width           =   37   End   Begin BevelButton bigbut      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   &h000000      Bevel           =   0      Bold            =   False      ButtonType      =   0      Caption         =   "big"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   22      HelpTag         =   ""      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   107      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   False      MenuValue       =   0      Scope           =   0      TabIndex        =   4      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   ""      TextUnit        =   0      Top             =   323      Underline       =   False      Value           =   False      Visible         =   True      Width           =   38   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Sub Activate()		  KeyboardUIMode.SetControls(self,KeyboardUIMode.GetMode)		End Sub	#tag EndEvent	#tag Event		Sub Close()		  f.Delete		End Sub	#tag EndEvent	#tag Event		Sub Open()		  loadtimeline		End Sub	#tag EndEvent	#tag MenuHandler		Function FileClose() As Boolean Handles FileClose.Action			me.close			Return True					End Function	#tag EndMenuHandler	#tag Method, Flags = &h0		Sub loadtimeline()		  dim socket1 as new httpsocket		  dim listdata, m, u, reply as string		  dim d as new dictionary		  dim d2 as new dictionary		  dim p as new xmlnodelist		  dim p2 as new xmlnodelist		  dim c , i as integer		  dim r as xmlnode		  socket1.yield = true		  socket1.setrequestheader "Authorization","Basic " + app.loginenc		  listdata= socket1.get("http://melative.com/api/statuses/friends_timeline.xml" ,10)		  If socket1.httpstatuscode = 200 then		    // Output the temp HTML		    dim stream as string		    Dim t as TextOutputStream		    f = SpecialFolder.Temporary		    f = f.child("t.html")		    t=TextOutputStream.Create(f)		    dim XML as new XMLDocument		    xml.LoadXML(listdata)		    r = getXMLroot(xml)		    p = getanything(r, "//statuses/status")		    p2 = getanything(r, "//statuses/status/user")		    c = p.Length - 1		    for i = 0 to c		      d = parseAnime(p.Item(i))		      d2 = parseAnime(p2.Item(i))		      If app.memusername = d2.value("screen_name")  then		        reply = ""		      else		        reply = "<br /><a href='ml:reply=" + d2.value("screen_name") + "'>reply</a>"		      end if		      u = "<a href='http://melative.com/" + d2.value("screen_name") +"'>"		      m = "<div class='update'><div class='userimage'>"+ u + "<img src='" + d2.value("profile_image_url") + "?size=48' alt='' /></a></div><div class='content'><b>" + u + d2.value("name") + "</a></b> " + d.value("text") + "<br /><small>"+ d.value("source") + " on " + d.value("created_at")+reply +"</small></div></div>" + endofline		      stream = stream + m		    next		    t.write htmHeader + stream + "</body>" + endofline + "</html>"		    t.close		    htmlviewer1.loadpage(f)		  end if		  //Reset Timer		  timer1.Reset		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub melpostupdate()		  dim socket1 as new httpsocket		  pushbutton1.enabled = false		  dim data as string		  		  // create and populate the form object		  dim form2 as New Dictionary		  // Set content		  		  // Use Normal Updating		  form2.value("message") = commentsfield.text		  // Set Client ( e.g. <username> in anime <time> ago from MAL Client OS X)		  form2.value("source") = "Melative Library"		  // setup the socket to POST the form		  socket1.setFormData form2		  socket1.setrequestheader "Authorization","Basic " + app.loginenc		  data = socket1.post("http://melative.com/api/micro/update.json",10)		  		  // release data from memory		  form2 = nil		  If socket1.httpstatuscode = 200 then		    commentsfield.text = ""		    pushbutton1.enabled = true		    loadtimeline		  else		    // Show Error		    self.errboxshow("Melative Library was unable to post your update on Melative",   "Check to see if your internet connection is working or revertify your Melative account information and try posting your update again.")		    pushbutton1.enabled = true		  end if		  		End Sub	#tag EndMethod	#tag Property, Flags = &h0		f As folderitem	#tag EndProperty	#tag Constant, Name = htmHeader, Type = String, Dynamic = False, Default = \"<html>\r<head>\r<style type\x3D\"text/css\">\ra:link {\rcolor: #338ec2;\rtext-decoration: none; \r}\ra:visited {\rcolor: #338ec2; \rtext-decoration: none; \r}\ra:hover {\rcolor: orange; \rtext-decoration: underline; \r}\ra:active {\rcolor: blue; \r}\rbody {\r\tfont-family: \"Segoe UI\"\x2C\"Lucida Grande\"\x2C Arial\x2C serif;\r\tfont-size: 14px;\r}\r.userimage {\r height: auto; \r width:48px; \r float:left; \r vertical-align:middle; \r}\r \r.content {\r margin-left: 58px;\r}\r\r.update {\r margin:5px;\r clear:left;\r padding:5px 0;\r}\r</style>\r<meta http-equiv\x3D\"Content-Type\" content\x3D\"text/html; charset\x3DUTF-8\" />\r</head>\r<body>\r", Scope = Public	#tag EndConstant#tag EndWindowCode#tag Events commentsfield	#tag Event		Sub TextChange()		  MessageLength.text = cstr(Len(commentsfield.text))		End Sub	#tag EndEvent#tag EndEvents#tag Events PushButton1	#tag Event		Sub Action()		  		  if commentsfield.text = "" then		    self.errboxshow("Melative Library was unable to post the update.", "You cannot leave the message field blank. You must have a message written.")		  else		    melpostupdate		  end if		End Sub	#tag EndEvent#tag EndEvents#tag Events Timer1	#tag Event		Sub Action()		  loadtimeline		End Sub	#tag EndEvent#tag EndEvents#tag Events HTMLViewer1	#tag Event		Function CancelLoad(URL as String) As Boolean		  If url = ReplaceAll(f.URLPath, "/localhost/", "//")  then		    return false		  elseif instr(url, "ml:reply=") > 0 then		    Commentsfield.text = "@" + replace(url, "ml:reply=", "")		    return true		  else		    showurl url		    return true		  end if		End Function	#tag EndEvent#tag EndEvents#tag Events BevelButton1	#tag Event		Sub Action()		  loadtimeline		End Sub	#tag EndEvent#tag EndEvents#tag Events smallbut	#tag Event		Sub Action()		  commentsfield.text = commentsfield.text + "<small></small>"		  commentsfield.selstart = commentsfield.text.Len		End Sub	#tag EndEvent#tag EndEvents#tag Events ItalicBut	#tag Event		Sub Action()		  commentsfield.text = commentsfield.text + "<i></i>"		  commentsfield.selstart = commentsfield.text.Len		End Sub	#tag EndEvent#tag EndEvents#tag Events BoldBut	#tag Event		Sub Action()		  commentsfield.text = commentsfield.text + "<b></b>"		  commentsfield.selstart = commentsfield.text.Len		End Sub	#tag EndEvent#tag EndEvents#tag Events delbut	#tag Event		Sub Action()		  commentsfield.text = commentsfield.text + "<del></del>"		  commentsfield.selstart = commentsfield.text.Len		End Sub	#tag EndEvent#tag EndEvents#tag Events bigbut	#tag Event		Sub Action()		  commentsfield.text = commentsfield.text + "<big></big>"		  commentsfield.selstart = commentsfield.text.Len		End Sub	#tag EndEvent#tag EndEvents
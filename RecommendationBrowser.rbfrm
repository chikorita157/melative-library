#tag WindowBegin Window RecommendationBrowser   BackColor       =   &hFFFFFF   Backdrop        =   ""   CloseButton     =   True   Composite       =   True   Frame           =   0   FullScreen      =   False   HasBackColor    =   False   Height          =   3.47e+2   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   True   MaxWidth        =   32000   MenuBar         =   866092770   MenuBarVisible  =   True   MinHeight       =   347   MinimizeButton  =   True   MinWidth        =   593   Placement       =   0   Resizeable      =   True   Title           =   "Recommendations Browser"   Visible         =   True   Width           =   5.93e+2   Begin StaticText StaticText1      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   289      LockBottom      =   False      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   True      Multiline       =   ""      Scope           =   0      TabIndex        =   0      TabPanelIndex   =   0      Text            =   "Username:"      TextAlign       =   2      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   7      Underline       =   ""      Visible         =   True      Width           =   100   End   Begin TextField TextField1      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      BackColor       =   &hFFFFFF      Bold            =   ""      Border          =   True      CueText         =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Format          =   ""      Height          =   22      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   399      LimitText       =   0      LockBottom      =   False      LockedInPosition=   False      LockLeft        =   False      LockRight       =   True      LockTop         =   True      Mask            =   ""      Password        =   ""      ReadOnly        =   ""      Scope           =   0      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   5      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   115   End   Begin Listbox Listbox1      AutoDeactivate  =   True      AutoHideScrollbars=   True      Bold            =   ""      Border          =   True      ColumnCount     =   1      ColumnsResizable=   ""      ColumnWidths    =   ""      DataField       =   ""      DataSource      =   ""      DefaultRowHeight=   -1      Enabled         =   True      EnableDrag      =   ""      EnableDragReorder=   ""      GridLinesHorizontal=   0      GridLinesVertical=   0      HasHeading      =   ""      HeadingIndex    =   -1      Height          =   208      HelpTag         =   ""      Hierarchical    =   ""      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   ""      Italic          =   ""      Left            =   0      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      RequiresSelection=   ""      Scope           =   0      ScrollbarHorizontal=   ""      ScrollBarVertical=   True      SelectionType   =   0      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   30      Underline       =   ""      UseFocusRing    =   False      Visible         =   True      Width           =   593      _ScrollWidth    =   -1   End   Begin BevelButton BevelButton1      AcceptFocus     =   False      AutoDeactivate  =   True      BackColor       =   "&c000000"      Bevel           =   0      Bold            =   False      ButtonType      =   0      Caption         =   "Lookup"      CaptionAlign    =   3      CaptionDelta    =   0      CaptionPlacement=   1      Enabled         =   True      HasBackColor    =   False      HasMenu         =   0      Height          =   27      HelpTag         =   ""      Icon            =   ""      IconAlign       =   0      IconDX          =   0      IconDY          =   0      Index           =   -2147483648      InitialParent   =   ""      Italic          =   False      Left            =   518      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   True      LockTop         =   True      MenuValue       =   0      Scope           =   0      TabIndex        =   3      TabPanelIndex   =   0      TabStop         =   True      TextColor       =   "&c000000"      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   1      Underline       =   False      Value           =   False      Visible         =   True      Width           =   74   End   Begin StaticText AnimeTitle      AutoDeactivate  =   True      Bold            =   True      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   13      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   False      LockTop         =   False      Multiline       =   ""      Scope           =   0      TabIndex        =   4      TabPanelIndex   =   0      Text            =   ""      TextAlign       =   0      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   241      Underline       =   ""      Visible         =   True      Width           =   489   End   Begin StaticText Reason      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   51      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   13      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   False      LockTop         =   False      Multiline       =   True      Scope           =   0      TabIndex        =   5      TabPanelIndex   =   0      Text            =   ""      TextAlign       =   0      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   266      Underline       =   ""      Visible         =   True      Width           =   557   End   Begin ProgressWheel ProgressWheel1      AutoDeactivate  =   True      Enabled         =   True      Height          =   16      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Left            =   13      LockBottom      =   False      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Scope           =   0      TabIndex        =   6      TabPanelIndex   =   0      TabStop         =   True      Top             =   7      Visible         =   False      Width           =   16   End   Begin StaticText recdate      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   13      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   ""      Multiline       =   ""      Scope           =   0      TabIndex        =   7      TabPanelIndex   =   0      Text            =   ""      TextAlign       =   0      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   11      TextUnit        =   0      Top             =   324      Underline       =   ""      Visible         =   True      Width           =   401   End   Begin PushButton AddBut      AutoDeactivate  =   True      Bold            =   ""      Cancel          =   ""      Caption         =   "Add"      Default         =   ""      Enabled         =   False      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   494      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   True      LockTop         =   ""      Scope           =   0      TabIndex        =   8      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   319      Underline       =   ""      Visible         =   True      Width           =   80   EndEnd#tag EndWindow#tag WindowCode	#tag Event		Sub Open()		  //set up listbox1 listbox		  listbox1.columncount=3		  listbox1.columnwidths="0,84%,16%"		  listbox1.HasHeading=True		  listbox1.Heading(0)="ID"		  listbox1.Heading(1)="Title"		  listbox1.Heading(2)="Type"		  listbox1.Column(0).UserResizable=false		  		End Sub	#tag EndEvent	#tag MenuHandler		Function FileClose() As Boolean Handles FileClose.Action			me.close			Return True					End Function	#tag EndMenuHandler	#tag Property, Flags = &h0		l As dictionary	#tag EndProperty#tag EndWindowCode#tag Events Listbox1	#tag Event		Sub Open()		  #If TargetMacOS		    me.Hierarchical = true		  #endif		End Sub	#tag EndEvent	#tag Event		Function CellBackgroundPaint(g As Graphics, row As Integer, column As Integer) As Boolean		  #If TargetMacOS		    if row mod 2 = 0 then		      g.forecolor = GetThemeColor(kThemeBrushListViewOddRowBackground)		    else		      g.forecolor = GetThemeColor(kThemeBrushListViewEvenRowBackground)		    end		    g.fillrect(0,0,g.width,g.height)		  #endif		End Function	#tag EndEvent	#tag Event		Sub Change()		  If me.listindex = -1 then		    animetitle.text = ""		    reason.text = ""		    recdate.text = ""		    addbut.enabled = false		  else		    dim t as new dictionary		    t = l.value(me.cell(me.listindex,0))		    animetitle.text = t.value("alias")		    reason.text = t.value("reason")		    recdate.text = "Recommended on: " + t.value("time")		    If Window1.l.haskey( me.cell(me.listindex,0)) = true then		      addbut.enabled = false		    else		      addbut.enabled = true		    end if		  End If		End Sub	#tag EndEvent#tag EndEvents#tag Events BevelButton1	#tag Event		Sub Action()		  progresswheel1.visible = true		  dim socket1 as new httpsocket		  dim listdata as string		  socket1.yield = true		  socket1.setrequestheader "Authorization","Basic " + app.loginenc		  listdata= socket1.get("http://melative.com/api/library/recommendations.xml?user=" + EncodeURLComponent(textfield1.text) ,10)		  If socket1.httpstatuscode = 200 then		    //Populate data to the list		    l = new dictionary		    dim XML as new XMLDocument		    dim d as new dictionary // store search info		    dim d2 as new dictionary		    dim p as new xmlnodelist // store search info		    dim p2 as new xmlnodelist		    dim c , i as integer		    dim r as xmlnode		    xml.LoadXML(listdata)		    r = getXMLroot(xml)		    p = getanything(r, "//response/recommendation/context") // Load search info		    p2 = getanything(r,"//response/recommendation")		    c = p.Length - 1		    listbox1.DeleteAllRows		    dim t as new dictionary		    for i = 0 to c		      t = new dictionary		      d = parseAnime(p.Item(i))		      d2= parseAnime(p2.item(i))		      if d.value("type") = "anime" or  d.value("type") = "manga" or d.value("type") = "lightnovel" or d.value("type") = "vn" or d.value("type") = "adrama" then		        listbox1.AddRow(d.value("id"))		        listbox1.Cell(listbox1.LastIndex, 1) = d.value("alias")		        listbox1.Cell(listbox1.LastIndex, 2) = d.value("type")		        t.value("alias") = d.value("alias")		        t.value("reason") = d2.value("reason")		        t.value("time") = d2.value("utc")		        t.value("type") = d.value("type")		        l.value(d.value("id")) = t		      end if		    next		    listbox1.listboxsort(1)		    progresswheel1.visible = false		  else		    errboxshowdialog("Melative Library was unable to perform a search.","Cannot retrieve data. Check your internet connection and try your search again.")		    progresswheel1.visible = false		  end if		End Sub	#tag EndEvent#tag EndEvents#tag Events AddBut	#tag Event		Sub Action()		  app.addnewtitle(Animetitle.text,Listbox1.cell(Listbox1.listindex,2))		End Sub	#tag EndEvent#tag EndEvents